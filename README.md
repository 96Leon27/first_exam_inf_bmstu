# üõçÔ∏è –°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ "–û–û–û –¢–º—ã–≤"
## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
* [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#–æ–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
* [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
* [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
* [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã](#–∑–∞–ø—É—Å–∫-–ø—Ä–æ–≥—Ä–∞–º–º—ã)
* [–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã](#–ø—Ä–∏–º–µ—Ä—ã-—Ä–∞–±–æ—Ç—ã)
* [–õ–æ–≥–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π](#–ª–æ–≥–∏-–∏-–∏—Å—Ç–æ—Ä–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏–π)
* [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
     
## üöÄ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–æ–º "–û–û–û –¢–º—ã–≤", —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ C++ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PostgreSQL. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –¥–æ—Å—Ç—É–ø–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º.

**–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
* C++17 —Å –û–û–ü (–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º, –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã)
* –£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (std::unique_ptr)
* PostgreSQL —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
* –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ libpqxx –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
* ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
* ‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ ‚Üí –æ–ø–ª–∞—Ç–∞ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞)
* ‚úÖ –¢—Ä–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
* ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
* ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
* C++17 –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (GCC/Clang)
* PostgreSQL 12+
* libpqxx –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
* Ubuntu/Debian:
  ```
  sudo apt update
  sudo apt install postgresql libpqxx-dev g++
  ```
* CentOS/RHEL:
  ```
  sudo yum install postgresql-server libpqxx-devel gcc-c++
  ```

* macOS:
  ```
  brew install postgresql libpqxx
  ```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞
### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
 ```
# –ó–∞–ø—É—Å–∫ PostgreSQL
sudo service postgresql start

# –í—Ö–æ–¥ –≤ psql
sudo -u postgres psql

# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE shop;

# –í—ã—Ö–æ–¥
\q
 ```

### 2. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
 ```
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
g++ -std=c++17 -o shop_system shop.cpp -lpqxx -lpq

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
./shop_system --version
 ```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ main():
 ```
std::string conn_str = "dbname=shop user=postgres password=–í–ê–®_–ü–ê–†–û–õ–¨ host=localhost";
```

## üèÉ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
```
./first_exam_inf_bmstu
```
# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
```
–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞

        –ò–ù–¢–ï–†–ù–ï–¢-–ú–ê–ì–ê–ó–ò–ù '–û–û–û –¢–º—ã–≤'
1. –í–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –í–æ–π—Ç–∏ –∫–∞–∫ –ú–µ–Ω–µ–¥–∂–µ—Ä
3. –í–æ–π—Ç–∏ –∫–∞–∫ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å
0. –í—ã—Ö–æ–¥
–í—ã–±–æ—Ä:
```

## üë• –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã –º–µ–Ω—é –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π

### üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

**–í—ã–±–æ—Ä –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é: ```1```**
```
        –ú–ï–ù–Æ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
2. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
3. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
4. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
5. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤
0. –í—ã—Ö–æ–¥
–í—ã–±–æ—Ä:
```

**–ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**
```
–í—ã–±–æ—Ä: 1
–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: –ò–≥—Ä–æ–≤–∞—è –º—ã—à—å Razer
–¶–µ–Ω–∞: 4500
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 25
–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω
```

**–ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤**
```
–í—ã–±–æ—Ä: 3
–í—Å–µ –∑–∞–∫–∞–∑—ã:
ID: 1001 | –ö–ª–∏–µ–Ω—Ç: –°–∏–¥–æ—Ä –ü–æ–∫—É–ø–∞—Ç–µ–ª–µ–≤ | –°—Ç–∞—Ç—É—Å: completed | –°—É–º–º–∞: 55000 | –î–∞—Ç–∞: 2024-01-15 14:30:25
ID: 1002 | –ö–ª–∏–µ–Ω—Ç: –ú–∞—Ä–∏—è –ö–ª–∏–µ–Ω—Ç–æ–≤–∞ | –°—Ç–∞—Ç—É—Å: pending | –°—É–º–º–∞: 30000 | –î–∞—Ç–∞: 2024-01-16 10:15:30
```

**–ü—Ä–∏–º–µ—Ä 3: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞**
```
–í—ã–±–æ—Ä: 4
ID –∑–∞–∫–∞–∑–∞: 1002
–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å (pending/processing/completed/canceled/returned): processing
–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω
```

### üëî –ú–µ–Ω–µ–¥–∂–µ—Ä
**–í—ã–±–æ—Ä –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é: ```2```**
```
        –ú–ï–ù–Æ –ú–ï–ù–ï–î–ñ–ï–†–ê
1. –ó–∞–∫–∞–∑—ã –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
2. –£—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤
0. –í—ã—Ö–æ–¥
–í—ã–±–æ—Ä: 
```

**–ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏**
```
–í—ã–±–æ—Ä: 1
–ó–∞–∫–∞–∑—ã –≤ –æ–∂–∏–¥–∞–Ω–∏–∏:
ID: 1002 | –ö–ª–∏–µ–Ω—Ç: –ú–∞—Ä–∏—è –ö–ª–∏–µ–Ω—Ç–æ–≤–∞ | –°—É–º–º–∞: 30000 | –î–∞—Ç–∞: 2024-01-16 10:15:30
```

**–ü—Ä–∏–º–µ—Ä 2: –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞**
```
–í—ã–±–æ—Ä: 2
ID –∑–∞–∫–∞–∑–∞ –¥–ª—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: 1002
–ó–∞–∫–∞–∑ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω
```

### üõí –ü–æ–∫—É–ø–∞—Ç–µ–ª—å
**–í—ã–±–æ—Ä –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é: ```3```**
```
        –ú–ï–ù–Æ –ü–û–ö–£–ü–ê–¢–ï–õ–Ø
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
2. –ú–æ–∏ –∑–∞–∫–∞–∑—ã
3. –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑
4. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤
0. –í—ã—Ö–æ–¥
–í—ã–±–æ—Ä: 
```

**–ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞**
```
–í—ã–±–æ—Ä: 1
–ó–∞–∫–∞–∑ #1003 —Å–æ–∑–¥–∞–Ω
–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä? (y/n): y
ID —Ç–æ–≤–∞—Ä–∞: 101
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 1
–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∑–∞–∫–∞–∑
–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä? (y/n): n
```

**–ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤**
```
–í—ã–±–æ—Ä: 2
–í–∞—à–∏ –∑–∞–∫–∞–∑—ã:
–ó–∞–∫–∞–∑ #1001 | –°—Ç–∞—Ç—É—Å: completed | –°—É–º–º–∞: 55000 | –î–∞—Ç–∞: 2024-01-15 14:30:25
  - –ù–æ—É—Ç–±—É–∫ x1 = 50000 —Ä—É–±.
  - –ù–∞—É—à–Ω–∏–∫–∏ x1 = 5000 —Ä—É–±.
```

**–ü—Ä–∏–º–µ—Ä 3: –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞**
```
–í—ã–±–æ—Ä: 3
ID –∑–∞–∫–∞–∑–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã: 1003
–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ: 54000 —Ä—É–±.
–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:
1. –ö–∞—Ä—Ç–∞
2. –ö–æ—à–µ–ª–µ–∫
3. –°–ë–ü
1
–û–ø–ª–∞—Ç–∞ card –Ω–∞ —Å—É–º–º—É 54000 —Ä—É–±. –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!
```

### üìã –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
**–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º —Ä–æ–ª—è–º):**
```
–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤:
ID: 101 | –ù–æ—É—Ç–±—É–∫ | –¶–µ–Ω–∞: 50000 —Ä—É–±. | –í –Ω–∞–ª–∏—á–∏–∏: 9 —à—Ç.
ID: 102 | –°–º–∞—Ä—Ç—Ñ–æ–Ω | –¶–µ–Ω–∞: 30000 —Ä—É–±. | –í –Ω–∞–ª–∏—á–∏–∏: 20 —à—Ç.
ID: 103 | –ù–∞—É—à–Ω–∏–∫–∏ | –¶–µ–Ω–∞: 5000 —Ä—É–±. | –í –Ω–∞–ª–∏—á–∏–∏: 49 —à—Ç.
ID: 104 | –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ | –¶–µ–Ω–∞: 2000 —Ä—É–±. | –í –Ω–∞–ª–∏—á–∏–∏: 28 —à—Ç.
ID: 105 | –ú—ã—à—å | –¶–µ–Ω–∞: 1000 —Ä—É–±. | –í –Ω–∞–ª–∏—á–∏–∏: 40 —à—Ç.
ID: 106 | –ò–≥—Ä–æ–≤–∞—è –º—ã—à—å Razer | –¶–µ–Ω–∞: 4500 —Ä—É–±. | –í –Ω–∞–ª–∏—á–∏–∏: 25 —à—Ç.
```

## üìä –õ–æ–≥–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–∫–∞–∑–æ–≤
### –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü—É ```order_status_history```.

**–°–ü—Ä–∏–º–µ—Ä SQL-–∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏:**
```
SELECT * FROM order_status_history 
WHERE order_id = 1001 
ORDER BY changed_at DESC;
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
 history_id | order_id | new_status  | changed_at          
------------+----------+-------------+---------------------
          4 |     1001 | returned    | 2024-01-20 09:15:30
          3 |     1001 | completed   | 2024-01-15 16:20:15
          2 |     1001 | processing  | 2024-01-15 14:35:10
          1 |     1001 | pending     | 2024-01-15 14:30:25
```

**–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π:**
1. **14:30:25** - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "pending"
2. **14:35:10** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "processing"
3. **16:20:15** - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ - —Å—Ç–∞—Ç—É—Å "completed"
4. **09:15:30** - –í–æ–∑–≤—Ä–∞—Ç –∑–∞–∫–∞–∑–∞ - —Å—Ç–∞—Ç—É—Å "returned"

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ:**
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é ```adminChangeOrderStatus()``` –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ç–∞–±–ª–∏—Ü—É ```order_status_history```:
```
// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª—Å—è)
txn.exec(
    "INSERT INTO order_status_history (order_id, new_status) "
    "SELECT " + txn.quote(order_id) + ", " + txn.quote(status) + " "
    "WHERE NOT EXISTS ("
    "SELECT 1 FROM orders WHERE order_id = " + txn.quote(order_id) + 
    " AND status = " + txn.quote(status) + ")"
);
```

### –ü–æ–ª–µ–∑–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
**1. –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:**
```
SELECT 
    osh.history_id,
    osh.order_id,
    u.name as customer_name,
    osh.new_status,
    osh.changed_at
FROM order_status_history osh
JOIN orders o ON osh.order_id = o.order_id
JOIN users u ON o.user_id = u.user_id
WHERE osh.order_id = 1001
ORDER BY osh.changed_at;
```
**2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ –¥–Ω—è–º:**
```
SELECT 
    DATE(changed_at) as date,
    COUNT(*) as status_changes,
    STRING_AGG(new_status, ', ') as statuses
FROM order_status_history
GROUP BY DATE(changed_at)
ORDER BY date DESC;
```
**3. –í—Ä–µ–º—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤ –∫–∞–∂–¥–æ–º —Å—Ç–∞—Ç—É—Å–µ:**
```
WITH status_times AS (
    SELECT 
        order_id,
        new_status,
        changed_at,
        LEAD(changed_at) OVER (PARTITION BY order_id ORDER BY changed_at) as next_change
    FROM order_status_history
)
SELECT 
    order_id,
    new_status,
    changed_at as status_start,
    next_change as status_end,
    COALESCE(EXTRACT(EPOCH FROM (next_change - changed_at))/3600, 0) as hours_in_status
FROM status_times
WHERE order_id = 1001;
```
**4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∑–∞–∫–∞–∑–æ–≤:**
```
SELECT 
    osh.new_status,
    COUNT(DISTINCT osh.order_id) as order_count,
    COUNT(*) as change_count
FROM order_status_history osh
GROUP BY osh.new_status
ORDER BY order_count DESC;
```

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
### –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    role VARCHAR(20) NOT NULL,
    password_hash VARCHAR(255)
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) CHECK (price > 0),
    stock_quantity INTEGER CHECK (stock_quantity >= 0)
);

-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id),
    status VARCHAR(20) DEFAULT 'pending',
    total_price DECIMAL(10,2) DEFAULT 0,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–∫–∞–∑–∞
CREATE TABLE order_items (
    order_item_id SERIAL PRIMARY KEY,
    order_id INTEGER REFERENCES orders(order_id),
    product_id INTEGER REFERENCES products(product_id),
    quantity INTEGER CHECK (quantity > 0),
    price DECIMAL(10,2)
);

-- –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
CREATE TABLE IF NOT EXISTS order_status_history (
    history_id SERIAL PRIMARY KEY,
    order_id INTEGER REFERENCES orders(order_id),
    new_status VARCHAR(20),
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
### –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:

<img width="714" height="915" alt="image" src="https://github.com/user-attachments/assets/eeddd4dd-6dee-461e-8f85-f1e4604e57d5" />

### –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü:
**1. users - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã**
* ```user_id``` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
* ```name``` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
* ```email``` - email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
* ```role``` - —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 'admin', 'manager', 'customer'
* ```password_hash``` - —Ö–µ—à –ø–∞—Ä–æ–ª—è (–≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
  
**2. products - –¢–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞**
* ```product_id``` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–≤–∞—Ä–∞
* ```name``` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
* ```price``` - —Ü–µ–Ω–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0)
* ```stock_quantity``` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)

**3. orders - –ó–∞–∫–∞–∑—ã**
* ```order_id``` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
* ```user_id``` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞–≤—à–µ–≥–æ –∑–∞–∫–∞–∑
* ```status``` - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: 'pending', 'processing', 'completed', 'canceled', 'returned'
* ```total_price``` - –æ–±—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
* ```order_date``` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

**4. order_items - –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞**
* ```order_item_id``` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–∏
* ```order_id``` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑
* ```product_id``` - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä
* ```quantity``` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0)
* ```price``` - —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

**5. order_status_history - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤**
* ```history_id``` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏
* ```order_id``` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑
* ```new_status``` - –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
* ```changed_at``` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö:
```
-- –ü—Ä–∏–º–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
INSERT INTO users (name, email, role) VALUES
('–ê–¥–º–∏–Ω', 'admin@shop.ru', 'admin'),
('–ú–µ–Ω–µ–¥–∂–µ—Ä', 'manager@shop.ru', 'manager'),
('–°–∏–¥–æ—Ä –ü–æ–∫—É–ø–∞—Ç–µ–ª–µ–≤', 'customer@shop.ru', 'customer');

-- –ü—Ä–∏–º–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤
INSERT INTO products (name, price, stock_quantity) VALUES
('–ù–æ—É—Ç–±—É–∫', 50000, 10),
('–°–º–∞—Ä—Ç—Ñ–æ–Ω', 30000, 20),
('–ù–∞—É—à–Ω–∏–∫–∏', 5000, 50);

-- –ü—Ä–∏–º–µ—Ä –∑–∞–∫–∞–∑–∞
INSERT INTO orders (user_id, status, total_price) VALUES
(3, 'completed', 55000);

-- –ü—Ä–∏–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–∫–∞–∑–∞
INSERT INTO order_items (order_id, product_id, quantity, price) VALUES
(1, 1, 1, 50000),  -- –ù–æ—É—Ç–±—É–∫
(1, 3, 1, 5000);   -- –ù–∞—É—à–Ω–∏–∫–∏

-- –ü—Ä–∏–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
INSERT INTO order_status_history (order_id, new_status) VALUES
(1, 'pending'),
(1, 'processing'),
(1, 'completed');
```

### üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö. –°–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã.


–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ "–û–û–û –¢–º—ã–≤" - —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ C++
